<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>STAFF CHECK-IN SYSTEM</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
}

.container{
  padding:30px;
}

.card{
  background:white;
  color:#333;
  padding:30px;
  border-radius:16px;
  max-width:420px;
  margin:auto;
  box-shadow:0 15px 40px rgba(0,0,0,0.3);
}

input{
  padding:12px;
  width:100%;
  margin-top:15px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button{
  padding:12px;
  margin-top:15px;
  width:100%;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
  background:#2c5364;
  color:white;
}

#reader{
  width:320px;
  margin:20px auto;
}

.result{
  margin-top:20px;
  padding:20px;
  border-radius:12px;
  font-weight:bold;
  font-size:20px;
}

.success{background:#d4edda;color:#155724;}
.warning{background:#fff3cd;color:#856404;}
.error{background:#f8d7da;color:#721c24;}
.hidden{display:none;}
</style>
</head>
<body>

<div class="container">

<div id="loginScreen" class="card">
  <h2>STAFF LOGIN</h2>
  <p>Ch·ªâ d√†nh cho nh√¢n vi√™n s·ª± ki·ªán</p>
  <input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t m√£">
  <button onclick="checkPassword()">ƒêƒÇNG NH·∫¨P</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="checkinScreen" class="hidden">
  <h2>üéü CHECK-IN SYSTEM</h2>
  <div id="reader"></div>
  <div id="result"></div>
</div>

</div>

<script>

const STAFF_PASSWORD = "SUGAR2026";

// üîê LOGIN
function checkPassword(){
  const input = document.getElementById("passwordInput").value;

  if(input === STAFF_PASSWORD){
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("checkinScreen").classList.remove("hidden");
    startScanner();
  }else{
    document.getElementById("loginError").innerText = "Sai m·∫≠t kh·∫©u!";
  }
}

// üì∑ START CAMERA
function startScanner(){

  const html5QrCode = new Html5Qrcode("reader");

  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    function(decodedText){

      let email = decodedText;

      // N·∫øu QR ch·ª©a link th√¨ t√°ch email
      if(decodedText.includes("email=")){
        const url = new URL(decodedText);
        email = url.searchParams.get("email");
      }

      fetch("https://script.google.com/macros/s/AKfycbzqk5n7_PKe2TJahtrSs50GVKHh8DCjie-PrFHebO_b6y0jT7-B0tVBk_3JyPI8o2tN/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: email })
      })
      .then(response => response.json())
      .then(data => {

        const resultDiv = document.getElementById("result");
        resultDiv.className = "result " + data.status;

        resultDiv.innerHTML = `
          ${data.name ? "üë§ " + data.name + "<br>" : ""}
          ${data.message}<br>
          ${data.time ? "‚è∞ " + data.time : ""}
        `;

        if(data.status === "success"){
          new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg").play();
        }

      })
      .catch(function(error){
        showError("L·ªói k·∫øt n·ªëi server");
        console.error(error);
      });

    }
  );
}

// ‚ùå ERROR
function showError(msg){
  const resultDiv = document.getElementById("result");
  resultDiv.className = "result error";
  resultDiv.innerHTML = msg;
}

</script>

</body>
</html>


