<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>STAFF CHECK-IN SYSTEM</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
}

.container{
  padding:30px;
}

.card{
  background:white;
  color:#333;
  padding:30px;
  border-radius:16px;
  max-width:420px;
  margin:auto;
  box-shadow:0 15px 40px rgba(0,0,0,0.3);
}

input{
  padding:12px;
  width:100%;
  margin-top:15px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button{
  padding:12px;
  margin-top:15px;
  width:100%;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
  background:#2c5364;
  color:white;
}

#reader{
  width:320px;
  margin:20px auto;
}

.result{
  margin-top:20px;
  padding:20px;
  border-radius:12px;
  font-weight:bold;
  font-size:20px;
}

.success{background:#d4edda;color:#155724;}
.warning{background:#fff3cd;color:#856404;}
.error{background:#f8d7da;color:#721c24;}
.hidden{display:none;}
</style>
</head>
<body>

<div class="container">

<div id="loginScreen" class="card">
  <h2>STAFF LOGIN</h2>
  <p>Ch·ªâ d√†nh cho nh√¢n vi√™n s·ª± ki·ªán</p>
  <input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t m√£">
  <button onclick="checkPassword()">ƒêƒÇNG NH·∫¨P</button>
  <p id="loginError" style="color:red;"></p>
</div>

<div id="checkinScreen" class="hidden">
  <h2>üéü CHECK-IN SYSTEM</h2>
  <div id="reader"></div>
  <div id="result"></div>
</div>

</div>

<script>
const STAFF_PASSWORD = "SUGAR2026";

function checkPassword(){
  const input = document.getElementById("passwordInput").value;
  if(input === STAFF_PASSWORD){
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("checkinScreen").classList.remove("hidden");
    startScanner();
  } else {
    document.getElementById("loginError").innerText = "Sai m·∫≠t kh·∫©u!";
  }
}

function startScanner(){
  const html5QrCode = new Html5Qrcode("reader");
  
  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    function(decodedText){
      // T·∫°m d·ª´ng qu√©t ƒë·ªÉ tr√°nh g·ª≠i tin li√™n t·ª•c
      html5QrCode.pause(true); 

      let email = decodedText;
      if(decodedText.includes("email=")){
        const url = new URL(decodedText);
        email = url.searchParams.get("email");
      }

      const resultDiv = document.getElementById("result");
      resultDiv.className = "result";
      resultDiv.innerHTML = "ƒêang ki·ªÉm tra...";

      fetch("https://script.google.com/macros/s/AKfycbxOCismnI58LPiF-O9uE-gTuEBH2S3sd2kEjabmPR536cW5Bbes6pSrkNV9WrB6NVJO/exec", {
        method: "POST",
        mode: "no-cors", // B·∫Øt bu·ªôc ƒë·ªÉ tr√°nh l·ªói CORS khi g·ªçi t·ª´ domain kh√°c
        headers: { "Content-Type": "text/plain" },
        body: JSON.stringify({ email: email })
      })
      .then(() => {
        // V·ªõi no-cors, ch√∫ng ta kh√¥ng ƒë·ªçc ƒë∆∞·ª£c n·ªôi dung tr·∫£ v·ªÅ (Success/Error)
        // ƒê√¢y l√† h·∫°n ch·∫ø l·ªõn nh·∫•t c·ªßa C√°ch 2
        resultDiv.className = "result success";
        resultDiv.innerHTML = "ƒê√É G·ª¨I Y√äU C·∫¶U!<br>H√£y ki·ªÉm tra Sheet ho·∫∑c Email.";
        
        // ƒê·ª£i 3 gi√¢y r·ªìi cho ph√©p qu√©t ti·∫øp
        setTimeout(() => { 
          resultDiv.innerHTML = ""; 
          html5QrCode.resume(); 
        }, 3000);
      })
      .catch(error => {
        showError("L·ªói k·∫øt n·ªëi server");
        html5QrCode.resume();
      });
    }
  ).catch(err => {
     console.error("Kh√¥ng th·ªÉ kh·ªüi ƒë·ªông camera", err);
  });
} // ƒê√≥ng h√†m startScanner

function showError(msg){
  const resultDiv = document.getElementById("result");
  resultDiv.className = "result error";
  resultDiv.innerHTML = msg;
}
</script>

</body>
</html>






